var 美化1 = "#fUI/ChatBalloon.img/pet/279/nw#";//选择道具
var 美化3 = "#fUI/ChatBalloon.img/pet/279/ne#";//选择道具
var 美化2 = "#fUI/ChatBalloon.img/pet/279/n#";//选择道具
var 美化4 = "#fUI/ChatBalloon.img/pet/279/sw#";//选择道具
var 美化5 = "#fUI/ChatBalloon.img/pet/279/se#";//选择道具
var 美化6 = "#fUI/ChatBalloon.img/pet/279/s#";//选择道具
var 美化7 = "#fUI/ChatBalloon.img/pet/279/head#";//选择道具
var 美化8 = "#fUI/ChatBalloon.img/pet/279/arrow#";//选择道具
var 爱心1 = "#fEffect/CharacterEff.img/1112946/0/0#";
var 爱心2 = "#fEffect/CharacterEff.img/1112905/0/1#";
var 爱心3 = "#fEffect/CharacterEff.img/1112946/1/0#";
var 爱心4 = "#fEffect/CharacterEff.img/1112946/1/1#";
var 爱心5 = "#fEffect/CharacterEff.img/1112946/2/0#";
var 爱心6 = "#fEffect/CharacterEff.img/1112946/2/1#";
var 爱心7 = "#fEffect/CharacterEff.img/1112946/3/0#";
var 爱心8 = "#fEffect/CharacterEff.img/1112946/3/1#";
var 爱心9 = "#fEffect/CharacterEff.img/1112906/0/1#";
var 爱心10 = "#fEffect/CharacterEff.img/1112903/1/0#";
var 制作 = "#fUI/UIWindow/Maker/BtStart/mouseOver/0#";
var 小lv数字0 = "#fUI/Basic/ShowLevel/0/0#";
var 小lv数字1 = "#fUI/Basic/ShowLevel/0/1#";
var 小lv数字2 = "#fUI/Basic/ShowLevel/0/2#";
var 小lv数字3 = "#fUI/Basic/ShowLevel/0/3#";
var 小lv数字4 = "#fUI/Basic/ShowLevel/0/4#";
var 小lv数字5 = "#fUI/Basic/ShowLevel/0/5#";
var 小lv数字6 = "#fUI/Basic/ShowLevel/0/6#";
var 小lv数字7 = "#fUI/Basic/ShowLevel/0/7#";
var 小lv数字8 = "#fUI/Basic/ShowLevel/0/8#";
var 小lv数字9 = "#fUI/Basic/ShowLevel/0/9#";
var 小lv = "#fUI/Basic/ShowLevel/0/left#";
var 右边框 = "#fUI/Basic/ShowLevel/Bracket/right#";


var 个人排名 = -1;
var 奖励数据 = {
	"副本1": [
		[
			[
				0,
				61017.0015
			],
			[
				4170005,
				0.25
			],
			[
				4170006,
				0.75
			],
			[
				4170005,
				0.26
			]
		],
		[
			[
				0,
				91070.1514
			],
			[
				4170005,
				0.25
			],
			[
				4170006,
				0.75
			],
			[
				4170005,
				0.89
			]
		],
		[
			[
				0,
				135925.5991
			],
			[
				4170005,
				0.5
			],
			[
				4170006,
				1.5
			],
			[
				4170005,
				0.81
			]
		],
		[
			[
				0,
				202874.0286
			],
			[
				4170005,
				1.0
			],
			[
				4170006,
				3.0
			],
			[
				4170005,
				0.2
			]
		],
		[
			[
				0,
				289371.9319
			],
			[
				4170005,
				1.25
			],
			[
				4170006,
				3.75
			],
			[
				4170005,
				0.26
			]
		],
		[
			[
				0,
				307461.0
			],
			[
				4170005,
				1.5
			],
			[
				4170006,
				4.5
			],
			[
				4170005,
				0.57
			]
		],
		[
			[
				0,
				338207.1
			],
			[
				4170005,
				2.0
			],
			[
				4170006,
				6.0
			],
			[
				4170005,
				0.21
			]
		],
		[
			[
				0,
				372027.81
			],
			[
				4170005,
				2.5
			],
			[
				4170006,
				7.5
			],
			[
				4170005,
				0.27
			]
		],
		[
			[
				0,
				409230.591
			],
			[
				4170005,
				3.0
			],
			[
				4170006,
				9.0
			],
			[
				4170005,
				0.84
			]
		],
		[
			[
				0,
				450153.6493
			],
			[
				4170005,
				4.0
			],
			[
				4170006,
				12.0
			],
			[
				4170005,
				0.05
			]
		],
		[
			[
				0,
				495169.0158
			],
			[
				4170005,
				5.0
			],
			[
				4170006,
				15.0
			],
			[
				4170005,
				0.07
			]
		],
		[
			[
				0,
				544685.9166
			],
			[
				4170005,
				6.0
			],
			[
				4170006,
				18.0
			],
			[
				4170005,
				0.08
			]
		],
		[
			[
				0,
				599154.5078
			],
			[
				4170005,
				7.5
			],
			[
				4170006,
				22.5
			],
			[
				4170005,
				0.1
			]
		],
		[
			[
				0,
				659069.959
			],
			[
				4170005,
				9.25
			],
			[
				4170006,
				27.75
			],
			[
				4170005,
				0.63
			]
		],
		[
			[
				0,
				724976.9555
			],
			[
				4170005,
				11.75
			],
			[
				4170006,
				35.25
			],
			[
				4170005,
				0.05
			]
		],
		[
			[
				0,
				797474.6502
			],
			[
				4170005,
				14.5
			],
			[
				4170006,
				43.5
			],
			[
				4170005,
				0.81
			]
		]
	]
};
function start() {
	status = -1;
	// cm.sendOk(cm.getOneTimeLog("制作"+"1121008") > 0 ? cm.getOneTimeLog("制作"+"1121008") : 0);
	action(1, 0, 0);
}
function action(mode, type, selection) {
	//var brs = cm.getBossRankCountTop4("希拉");//开放
	var 等级 = cm.getPlayer().getLevel();
	var 名字 = cm.getPlayer().getName();
	if (mode == -1) {
		cm.dispose();
	} else {
		if (status >= 0 && mode == 0) {
			cm.sendOk("感谢你的光临！");
			cm.dispose();
			return;
		}
		if (mode == 1) {
			status++;
		} else {
			status--;
		}
		if (status == 0) {
			// 排名 = 1;
			var text = "";
			text += "副本一奖励发放"
			// text += "  #w名次            伤害              名字  \r\n"
			// text += "玩家奖励发放";
			// for (var i = 0; i<(brs.size()); i++) {
			// var br = brs.get(i);
			// text += "  #bNo.#r" + (i+1) + "#k             #b" + cm.getString(br.getCount(), 8) + "#k          #r" + br.getName() + "#k\r\n"
			// }



			// var toSpawn = cm.获取BOSS伤害排行("希拉");
			// for (var i = 0; i < toSpawn.length; i++) {
			// 	if (toSpawn[i].getLeft() == cm.getPlayer().getName()) {
			// 		个人排名 = i + 1;
			// 		cm.sendOk(个人排名);
			// 		cm.dispose();
			// 	}
			// 	text += "#rNO." + (i + 1) + "#k " + toSpawn[i].getLeft() + " : " + toSpawn[i].getRight() + "\r\n";
			// }

			cm.sendSimpleS(text, 2);
		} else if (status == 1) {
			// for (var i = 0; i<(brs.size()); i++) {
			// var br = brs.get(i);
			// if(cm.getName() == br.getName()){
			// 排名 = (i+1);
			// break;
			// }
			// }
			// for (var i = 0; i < 给予.length; i++) {
			// 	if (排名 == 给予[i][0]) {
			// 		if (cm.getLevel() >= 给予[i][1] && cm.getLevel() < 给予[i][2]) {
			// 			cm.gainItem(给予[i][3], 给予[i][4]);
			// 		}
			// 	}
			// }


			// var index = getLevelIndex(等级);
			// if (index === -1) {
			// 	return; // 等级不在奖励范围内
			// }
			// var 奖励列表 = 奖励["个人"][index];
			// for (var i = 0; i < 奖励列表.length; i++) {
			// 	var 物品ID = 奖励列表[i][0];
			// 	var 爆率 = 奖励列表[i][1];
			// 	var 数量 = rate(爆率);
			// 	if (数量 > 0) {
			// 		cm.gainItem(物品ID, 数量);
			// 	}
			// }


			// var index = getLevelIndex(等级); 
			// var 远征名 = "团队远征" + (index + 1);
			// var 奖励列表 = 奖励数据[远征名];
			// for (var i = 0; i < 奖励列表.length; i++) {
			// 	var 奖励段 = 奖励列表[i]; 
			// 	for (var j = 1; j < 奖励段.length; j++) {
			// 		var 材料ID = 奖励段[j][0];
			// 		var 材料爆率 = 奖励段[j][1];
			// 		var 数量 = rate(材料爆率);
			// 		if (数量 > 0) {
			// 			cm.gainItem(材料ID, 数量);
			// 		}
			// 	}
			// }


			var index = getLevelIndex(等级);
			if (index === -1) {
				return; // 等级不在奖励范围内
			}
			var 奖励列表 = 奖励数据["副本1"][index];
			for (var i = 0; i < 奖励列表.length; i++) {
				var 物品ID = 奖励列表[i][0];
				var 爆率 = 奖励列表[i][1];
				var 数量 = rate(爆率);
				if (数量 > 0) {
					cm.gainItem(物品ID, 数量);
				}
			}


			// cm.sendOk("领取 伤害排行第 " + 排名 + " 名奖励");
			// cm.sendOk(等级);
			cm.setBossLog("副本1");
			cm.sendOk("奖励发放成功")

			cm.dispose();


		} else if (selection == 30) {
			cm.dispose();
			cm.openNpc(9900001, "矿石仓库");
		}
	}
}

function getLevelIndex(等级) {
	var levels = [70, 90, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200, 210, 220, 230, 240];
	for (var i = 0; i < levels.length; i++) {
		if (等级 <= levels[i]) {
			return i;
		}
	}
	return -1;
}


function rate(材料爆率) {
	var 整数部分 = Math.floor(材料爆率);
	var 小数部分 = 材料爆率 - 整数部分;
	var 获得数量 = 整数部分;
	if (小数部分 > 0) {
		if (Math.random() < 小数部分) {
			获得数量 += 1;
		}
	}
	return 获得数量;
}

